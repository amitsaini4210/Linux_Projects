                                                                     Disk Management & LVM Project
                                                                        ğŸ¯ Project Objective
                                     Configure storage using partitions + LVM, resize disks safely, mount permanently.
************************************************************************************************************************************************************************************************************************************************

1PE ==4MB
PE hi aage jake LE banata hai
--------------------------
PE = 125*4 = 500MB   
LE = 500/4 = 125 PE

************************************************************************************************************************
Check disk:
lsblk
************************************************************************************************************************

ğŸ”¹ Step 1: Create Disk Partition

fdisk /dev/sdb

Inside fdisk:
n   â†’ new partition
p   â†’ primary
1   â†’ partition number
Enter â†’ default start
Enter â†’ +5G   (for 5GB partition) end
t   â†’ change type
8e  â†’ Linux LVM
w   â†’ write

************************************************************************************************************************
ğŸ”¹ Step 2: Create LVM Structure

1ï¸âƒ£ Create Physical Volume (PV)
pvcreate /dev/sdb1
pvdisplay
pvs
****************************************************
2ï¸âƒ£ Create Volume Group (VG)
vgcreate  myvg1  /dev/sdb1
vgdisplay
vgs


Vg auto take 4M PE size but when mention take it. 8M PE
vgcreate -s 8M fedora /dev/sdb5

****************************************************
3ï¸âƒ£ Create Logical Volume (LV)
lvcreate  -L  +5G  -n  mylv1  /dev/myvg1
lvdisplay
************************************************************************************************************************

ğŸ”¹ Step 3: Create Filesystem

mkfs.xfs /dev/myvg1/mylv1
mkfs.ext4 /dev/myvg1/mylv2
************************************************************************************************************************
ğŸ”¹ Step 4: Mount Logical Volume
mkdir  /lvm1
mkdir  /lvm2


Mount:
mount  /dev/myvg1/mylv1  /lvm1
mount  /dev/myvg1/mylv2  /lvm2


check lvm:
lvs


Verify:
df -h


************************************************************************************************************************
ğŸ”¹ Step 5: Permanent Mount (fstab)

vim /etc/fstab
/dev/myvg1/mylv1   /lvm1   xfs    defaults   0 0
/dev/myvg2/mylv2   /lvm2   ext4   defaults   0 0

Test:
mount -a
******************************************************************************************************************************************************************************************************************************
                    ---------------------------------EXTEND Volume size

Task-1
if Filesystem Type is in ext2, ext3 and ext-4

First method: using Two commands  ==> lvextend and resize2fs
Second method: using single commands ==> using lvresize



Task-2
if Filesystem Type is in xfs  
First method:    lvextend + xfs_growfs { support till rhel-7 }
Second method:  lvresize {recommended command in rhel-8}

**********************************************************************************
ğŸ”¹ Step 6: Resize Logical Volume

check available size:
vgs

â• Extend LV (Live, no data loss)

lvextend  -L  +2G   /dev/myvg1/mylv2

lvresize -L 3GB  -r /dev/myvg1/mylv2


Verify:
df -h
************************************************************************************************************************
                                                        LVM Reduce

LVM Reduce
==>
1- support only in offline mode
2- LVM reduce operation does not support in xfs based filesystem. but it is possible in ext2 ext3 and ext-4.


lvresize   -L   1GB  -r   /dev/myvg1/mylv2
************************************************************************************************************************

                                                      VG EXTEND

fdisk /dev/sdb
partprobe /dev/sdb
udevadm settle

vgextend  myvg1  /dev/sdb3
pvs
************************************************************************************************************************
                                                  Activate and deactivate LVM
-an = activate no
-ay = activate yes


lvchange -an  /dev/myvg1/mylv2
lvs

lvchange -ay  /dev/myvg1/mylv2

************************************************************************************************************************
 
                                             LVM corrupt with wrong command recover it 
                                    it make index number before command execution this index number help for recovering



store in this location:--->
/etc/lvm/archive


check link:
vgcfgrestore  -l fedora

restore:
vgcfgrestore -f /etc/lvm/archive/fedora_00002-1964966695.vg fedora 
************************************************************************************************************************

                                              HOW WE CAN MERGE VOLUME GROUPS.




vgmerge   /dev/myvg1    /dev/myvg2                -----(merge vg2 in vg1)

systemctl daemon reload
df -Th

mount  /dev/myvg1/mylv3   /lvm4
************************************************************************************************************************
                                                     Lvremove


lvremove  /dev/myvg1/mylv3
lvremove  /dev/myvg1/mylv2
lvremove  /dev/myvg1/mylv1


vgremove /dev/myvg1

pvremove  /dev/sdb{1,2,3} 

************************************************************************************************************************

                                                      Disk partition using parted command
                                        parted is used for both MBR and GPT disks, especially GPT disks ( >2TB ).


ğŸ”¹ Step 1: Check Disk & Partition Table
lsblk
parted -l
*********************************************************************
ğŸ”¹ Step 2: Open Disk in parted
Parted    /dev/sdc  mklabel msdos

*********************************************************************
ğŸ”¹Step 3: Create Partition Table

ğŸ‘‰ For MBR (msdos)
mklabel msdos

ğŸ‘‰ For GPT 
mklabel gpt

*********************************************************************
ğŸ”¹ Step 4: Create Partition

mkpart
primary/extended
ext4
start 2048s
end   1024MB
*********************************************************************

ğŸ”¹ Step 5: Verify Partition
print
*********************************************************************

ğŸ”¹ Step 6: Exit parted
quit
*********************************************************************
ğŸ”¹ Step 7: Reload Partition Table

partprobe /dev/sdb
udevadm settle
*********************************************************************
 
ğŸ”¹ Step 8: After Partition Creation

ğŸ‘‰ For filesystem
mkfs.ext4 /dev/sdb1


ğŸ‘‰ For LVM
pvcreate /dev/sdb1

*********************************************************************


















